import{m as X,a as Y}from"./VSelect.a06edcaa.js";import{ac as Z,a8 as _,q,aC as R,aw as ee,a4 as te,a5 as le,Q as ae,W as ne,k as P,a6 as j,D as B,aK as z,L as ue,p as r,F as W,a3 as O,ab as oe,z as se}from"./index.86c412e1.js";import{f as re}from"./forwardRefs.c003b6b8.js";import{u as ie,V as ce,a as Q}from"./VList.ad2ad9f6.js";import{c as fe,d as ve,V as de}from"./VTextField.c9631f5f.js";import{V as me}from"./VMenu.e205bd21.js";import{V as pe}from"./VChip.dfffcf8f.js";const he=(e,n,t)=>e==null||n==null?-1:e.toString().toLocaleLowerCase().indexOf(n.toString().toLocaleLowerCase()),ye=Z({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function ge(e,n,t){var p,F;const y=[],g=(p=t==null?void 0:t.default)!=null?p:he,v=t!=null&&t.filterKeys?R(t.filterKeys):!1,d=Object.keys((F=t==null?void 0:t.customKeyFilter)!=null?F:{}).length;if(!(e!=null&&e.length))return y;e:for(let C=0;C<e.length;C++){const a=e[C],i={},h={};let c=-1;if(n&&!(t!=null&&t.noFilter)){if(typeof a=="object"){const T=v||Object.keys(a);for(const V of T){var s;const x=ee(a,V,a),b=t==null||(s=t.customKeyFilter)==null?void 0:s[V];if(c=b?b(x,n,a):g(x,n,a),c!==-1&&c!==!1)b?i[V]=c:h[V]=c;else if((t==null?void 0:t.filterMode)==="every")continue e}}else c=g(a,n,a),c!==-1&&c!==!1&&(h.title=c);const I=Object.keys(h).length,k=Object.keys(i).length;if(!I&&!k||(t==null?void 0:t.filterMode)==="union"&&k!==d&&!I||(t==null?void 0:t.filterMode)==="intersection"&&(k!==d||!I))continue}y.push({index:C,matches:{...h,...i}})}return y}function ke(e,n,t){const y=_(()=>typeof(t==null?void 0:t.value)!="string"&&typeof(t==null?void 0:t.value)!="number"?"":String(t.value));return{filteredItems:_(()=>{const v=q(n);return ge(v,y.value,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}).map(s=>{let{index:p,matches:F}=s;return{item:v[p],matches:F}})})}}function Ve(e,n,t){if(Array.isArray(n))throw new Error("Multiple matches is not implemented");return typeof n=="number"&&~n?r(W,null,[r("span",{class:"v-autocomplete__unmask"},[e.substr(0,n)]),r("span",{class:"v-autocomplete__mask"},[e.substr(n,t)]),r("span",{class:"v-autocomplete__unmask"},[e.substr(n+t)])]):e}const Pe=te()({name:"VAutocomplete",props:{search:String,...ye({filterKeys:["title"]}),...X(),...le(fe({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...ae({transition:!1})},emits:{"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,n){let{slots:t}=n;const{t:y}=ne(),g=P(),v=P(!1),d=P(!0),s=j(e,"menu"),{items:p,transformIn:F,transformOut:C}=ie(e),a=j(e,"search",""),i=j(e,"modelValue",[],l=>F(R(l)),l=>{var o;const u=C(l);return e.multiple?u:(o=u[0])!=null?o:null}),{filteredItems:h}=ke(e,p,_(()=>d.value?void 0:a.value)),c=_(()=>i.value.map(l=>p.value.find(u=>u.value===l.value)||l)),I=_(()=>c.value.map(l=>l.props.value)),k=P();function T(l){i.value=[],e.openOnClear&&(s.value=!0),a.value=""}function V(){e.hideNoData&&!p.value.length||e.readonly||(s.value=!0)}function x(l){if(!e.readonly){if(["Enter","ArrowDown"].includes(l.key)&&(s.value=!0),["Escape"].includes(l.key)&&(s.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(d.value=!0),l.key==="ArrowDown"){var u;l.preventDefault(),(u=k.value)==null||u.focus("next")}else if(l.key==="ArrowUp"){var o;l.preventDefault(),(o=k.value)==null||o.focus("prev")}}}function b(l){a.value=l.target.value}function $(){v.value&&(d.value=!0)}function G(l){v.value=!0}function H(l){if(l.relatedTarget==null){var u;(u=g.value)==null||u.focus()}}const w=P(!1);function L(l){if(e.multiple){const u=I.value.findIndex(o=>o===l.value);if(u===-1)i.value=[...i.value,l],a.value="";else{const o=[...i.value];o.splice(u,1),i.value=o}}else i.value=[l],w.value=!0,t.selection||(a.value=l.title),s.value=!1,d.value=!0,z(()=>w.value=!1)}return B(v,l=>{var o;if(l){var u;w.value=!0,a.value=e.multiple||!!t.selection?"":String((o=(u=c.value.at(-1))==null?void 0:u.props.title)!=null?o:""),d.value=!0,z(()=>w.value=!1)}else s.value=!1,a.value=""}),B(a,l=>{!v.value||w.value||(l&&(s.value=!0),d.value=!l)}),ue(()=>{const l=!!(e.chips||t.chip),[u]=ve(e);return r(de,O({ref:g},u,{modelValue:a.value,"onUpdate:modelValue":o=>{o==null&&(i.value=[])},validationValue:i.externalValue,dirty:i.value.length>0,onInput:b,class:["v-autocomplete",{"v-autocomplete--active-menu":s.value,"v-autocomplete--chips":!!e.chips,[`v-autocomplete--${e.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!t.selection}],appendInnerIcon:e.menuIcon,readonly:e.readonly,"onClick:clear":T,"onClick:control":V,"onClick:input":V,onFocus:()=>v.value=!0,onBlur:()=>v.value=!1,onKeydown:x}),{...t,default:()=>{var o,E,N;return r(W,null,[r(me,O({modelValue:s.value,"onUpdate:modelValue":f=>s.value=f,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:$},e.menuProps),{default:()=>[r(ce,{ref:k,selected:I.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:f=>f.preventDefault(),onFocusin:G,onFocusout:H},{default:()=>{var f;return[!h.value.length&&!e.hideNoData&&((f=(o=t["no-data"])==null?void 0:o.call(t))!=null?f:r(Q,{title:y(e.noDataText)},null)),(E=t["prepend-item"])==null?void 0:E.call(t),h.value.map((K,A)=>{var U;var M;let{item:m,matches:J}=K;return(U=(M=t.item)==null?void 0:M.call(t,{item:m,index:A,props:O(m.props,{onClick:()=>L(m)})}))!=null?U:r(Q,O({key:A},m.props,{onClick:()=>L(m)}),{prepend:D=>{let{isSelected:S}=D;return e.multiple&&!e.hideSelected?r(Y,{modelValue:S,ripple:!1},null):void 0},title:()=>{var S;var D;return d.value?m.title:Ve(m.title,J.title,(S=(D=a.value)==null?void 0:D.length)!=null?S:0)}})}),(N=t["append-item"])==null?void 0:N.call(t)]}})]}),c.value.map((f,K)=>{function A(m){m.stopPropagation(),m.preventDefault(),L(f)}const M={"onClick:close":A,modelValue:!0,"onUpdate:modelValue":void 0};return r("div",{key:f.value,class:"v-autocomplete__selection"},[l?r(oe,{defaults:{VChip:{closable:e.closableChips,size:"small",text:f.title}}},{default:()=>[t.chip?t.chip({item:f,index:K,props:M}):r(pe,M,null)]}):t.selection?t.selection({item:f,index:K}):r("span",{class:"v-autocomplete__selection-text"},[f.title,e.multiple&&K<c.value.length-1&&r("span",{class:"v-autocomplete__selection-comma"},[se(",")])])])})])}})}),re({isFocused:v,isPristine:d,menu:s,search:a,filteredItems:h,select:L},g)}});export{Pe as V};
